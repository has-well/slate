# Subscription

## Subscription url

> Example:

```php
<?php
  require 'vendor/autoload.php';

  \Cloudipsp\Configuration::setMerchantId(1396424);
  \Cloudipsp\Configuration::setSecretKey('test');
  \Cloudipsp\Configuration::setApiVersion('2.0');
  $data = [
        'currency' => 'USD',
        'amount' => 1000, // convert to 10.00$
        'recurring_data' => [
            'start_time' => '2021-12-24',
            'amount' => 1000,
            'every' => 30,
            'period' => 'day',
            'state' => 'y',
            'readonly' => 'y'
        ]
    ];
  $url = \Cloudipsp\Subscription::url($data);
  $data = $url->getData();
```

```(array)``` <span class="green">getData()</span> — returns checkout url.

```(null)``` <span class="green">toCheckout()</span> — redirect to checkout page.

Required request Parameters:

Parameters      | Description
----------------|-------------------------------------------------------------------------------------------------------
```order_id```        | Order ID. Can be generated by SDK.
```merchant_id```     | Merchant unique ID.
```order_desc```      | Order description. Generated by merchant in UTF-8. Can be generated by SDK.
```signature```       | Order signature. Required to verify merchant request consistency and authenticity. Can be generated by SDK.
```amount```	        | Order amount in cents without separator.
```currency```        | Order currency(USD,EUR,RUB and others).
```recurring_data```  | Subscription info.
```start_time```      | Start calendar payment format("Y-m-d").
```amount```  | Subscription amount.
```every```  | Frequency of payments(number).
```period```  | Frequency of payments('day','month','week').
```state```  | Checkout calendar state "y" - enabled.
```readonly```  | Checkout calendar readonly.

<aside class="notice">
<p class="nothing">
merchant_data and recurring_data — will be converted to json string.<br/>
Method only for protocol <b>2.0</b>.<br/>
Response is always returned in request context in the same content-type. So if request is sent in JSON, response will be sent in JSON format too.
</p>
</aside>

Host-to-host API v2.0 supports the following text formats:

* json

**All other params look in provider documentation.**


## Subscription token

> Example:

```php

<?php
  require 'vendor/autoload.php';

  \Cloudipsp\Configuration::setMerchantId(1396424);
  \Cloudipsp\Configuration::setSecretKey('test');
  \Cloudipsp\Configuration::setApiVersion('2.0');
  $data = [
          'order_desc' => 'tests SDK',
          'currency' => 'USD',
          'amount' => 1000,
          'merchant_data' => [
              'custom_data1' => 'Some string'
          ],
           'recurring_data' => [
                      'start_time' => '2021-12-24',
                      'amount' => 1000,
                      'every' => 30,
                      'period' => 'day',
                      'state' => 'y',
                      'readonly' => 'y'
           ]
    ];
  $token = \Cloudipsp\Subscription::token($data);

```

```(array)``` Returns checkout token.

Required request Parameters:

<aside class="notice">
Look in <a href="#payment-url-host-to-host">Same as in url.</a>
</aside>


## Subscription stop

> Example:

```php

<?php
  require 'vendor/autoload.php';

  \Cloudipsp\Configuration::setMerchantId(1396424);
  \Cloudipsp\Configuration::setSecretKey('test');
  \Cloudipsp\Configuration::setApiVersion('2.0');
  $cancel = Cloudipsp\Subscription::stop($order_id);

```

```(array)``` Returns info about calendar status.
